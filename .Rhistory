# Plot
ggplot(df, aes(x = term, y = estimate)) +
geom_point(size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2) +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray40") +
df <- did_model
# Calculate 95% confidence intervals
df$lower <- df$estimate - 1.96 * df$std_error
df$upper <- df$estimate + 1.96 * df$std_error
# Plot
ggplot(df, aes(x = term, y = estimate)) +
geom_point(size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2) +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray40") +
coord_flip() +
labs(
title = "Coefficient Plot",
x = "Covariates",
y = "Estimate (with 95% CI)"
) +
theme_minimal(base_size = 14)
df <- df.frame(did_model)
df <- df.phrame(did_model)
# Extract regression summary as a tidy data frame
library(broom)
# Convert model summary to a data frame
df <- tidy(did_model)
# Add confidence intervals
df <- df %>%
mutate(
lower = estimate - 1.96 * std.error,
upper = estimate + 1.96 * std.error
)
# Calculate 95% confidence intervals
df$lower <- df$estimate - 1.96 * df$std_error
df$upper <- df$estimate + 1.96 * df$std_error
# Extract regression summary as a tidy data frame
library(broom)
# Convert model summary to a data frame
df <- tidy(did_model)
# Add confidence intervals
df <- df %>%
mutate(
lower = estimate - 1.96 * std.error,
upper = estimate + 1.96 * std.error
)
# Plot
ggplot(df, aes(x = term, y = estimate)) +
geom_point(size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2) +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray40") +
coord_flip() +
labs(
title = "Coefficient Plot",
x = "Covariates",
y = "Estimate (with 95% CI)"
) +
theme_minimal(base_size = 14)
ggplot(data, aes(x = Year, y = Binge_Drinking_Prevalence, group = State, color = as.factor(Legalized))) +
geom_line(alpha = 0.6) +
labs(
title = "Binge Drinking Prevalence Over Time by State",
x = "Year",
y = "Binge Drinking Prevalence (%)",
color = "Legalized"
) +
theme_minimal() +
theme(legend.position = "bottom")
data_aligned <- data %>%
filter(!is.na(Legalization_Year)) %>%
mutate(relative_year = Year - Legalization_Year)
ggplot(data_aligned, aes(x = relative_year, y = Binge_Drinking_Prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "blue", size = 1.2) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Binge Drinking Trends Aligned to Legalization Year",
x = "Years Relative to Legalization",
y = "Binge Drinking Prevalence (%)"
) +
theme_minimal()
ggplot(data_aligned, aes(x = relative_year, y = Binge_Drinking_Prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "blue", linewidth = 1.2) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Binge Drinking Trends Aligned to Legalization Year",
x = "Years Relative to Legalization",
y = "Binge Drinking Prevalence (%)"
) +
theme_minimal()
ggplot(data_aligned, aes(x = relative_year, y = Binge_Drinking_Prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "orange", linewidth = 1.2) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Binge Drinking Trends Aligned to Legalization Year",
x = "Years Relative to Legalization",
y = "Binge Drinking Prevalence (%)"
) +
theme_minimal()
ggplot(data_aligned, aes(x = relative_year, y = Binge_Drinking_Prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "orange", linewidth = .8) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Binge Drinking Trends Aligned to Legalization Year",
x = "Years Relative to Legalization",
y = "Binge Drinking Prevalence (%)"
) +
theme_minimal()
ggplot(data_aligned, aes(x = relative_year, y = Binge_Drinking_Prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "orange", linewidth = .8) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Binge Drinking Trends Aligned to Legalization Year",
x = "Years Relative to Legalization",
y = "Binge Drinking Prevalence (%)"
) +
theme_minimal()
data_normalized <- data %>%
filter(!is.na(Legalization_Year)) %>%
mutate(relative_year = Year - Legalization_Year) %>%
group_by(State) %>%
mutate(
baseline = Binge_Drinking_Prevalence[relative_year == 0],
normalized_prevalence = Binge_Drinking_Prevalence - baseline
) %>%
ungroup()
ggplot(data_normalized, aes(x = relative_year, y = normalized_prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "blue", size = 1.2) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Normalized Binge Drinking Trends (Aligned to Legalization Year)",
x = "Years Relative to Legalization",
y = "Change in Binge Drinking Prevalence (%)"
) +
theme_minimal()
ggplot(data_normalized, aes(x = relative_year, y = normalized_prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "blue", size = .8) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Normalized Binge Drinking Trends (Aligned to Legalization Year)",
x = "Years Relative to Legalization",
y = "Change in Binge Drinking Prevalence (%)"
) +
theme_minimal()
ggplot(data_normalized, aes(x = relative_year, y = normalized_prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "orange", size = .8) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Normalized Binge Drinking Trends (Aligned to Legalization Year)",
x = "Years Relative to Legalization",
y = "Change in Binge Drinking Prevalence (%)"
) +
theme_minimal()
ggplot(data_normalized, aes(x = relative_year, y = normalized_prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "orange", size = .8) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Normalized Binge Drinking Trends (Aligned to Legalization Year)",
x = "Years Relative to Legalization",
y = "Change in Binge Drinking Prevalence (%)"
) +
theme_minimal()
data_control <- data %>%
filter(Legalized == 0) %>%
mutate(relative_year = Year - 2016) %>%
group_by(State) %>%
mutate(
baseline = Binge_Drinking_Prevalence[Year == 2016],
normalized_prevalence = Binge_Drinking_Prevalence - baseline
) %>%
ungroup()
ggplot(data_control, aes(x = relative_year, y = normalized_prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "blue", size = 1.2) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Normalized Binge Drinking Trends (Control States Aligned at 2016)",
x = "Years Relative to 2016 (Placebo Treatment Year)",
y = "Change in Binge Drinking Prevalence (%)"
) +
theme_minimal()
ggplot(data_control, aes(x = relative_year, y = normalized_prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "orange", size = .8) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Normalized Binge Drinking Trends (Control States Aligned at 2016)",
x = "Years Relative to 2016 (Placebo Treatment Year)",
y = "Change in Binge Drinking Prevalence (%)"
) +
theme_minimal()
ggplot(data_control, aes(x = relative_year, y = normalized_prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "orange", size = .5) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Normalized Binge Drinking Trends (Control States Aligned at 2016)",
x = "Years Relative to 2016 (Placebo Treatment Year)",
y = "Change in Binge Drinking Prevalence (%)"
) +
theme_minimal()
ggplot(data_control, aes(x = relative_year, y = normalized_prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "orange", size = .3) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Normalized Binge Drinking Trends (Control States Aligned at 2016)",
x = "Years Relative to 2016 (Placebo Treatment Year)",
y = "Change in Binge Drinking Prevalence (%)"
) +
theme_minimal()
ggplot(data_normalized, aes(x = relative_year, y = normalized_prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "orange", size = .5) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Normalized Binge Drinking Trends (Aligned to Legalization Year)",
x = "Years Relative to Legalization",
y = "Change in Binge Drinking Prevalence (%)"
) +
theme_minimal()
data_control <- data %>%
filter(Legalized == 0) %>%
mutate(relative_year = Year - 2014) %>%
group_by(State) %>%
mutate(
baseline = Binge_Drinking_Prevalence[Year == 2014],
normalized_prevalence = Binge_Drinking_Prevalence - baseline
) %>%
ungroup()
ggplot(data_control, aes(x = relative_year, y = normalized_prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "orange", size = .3) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Normalized Binge Drinking Trends (Control States Aligned at 2016)",
x = "Years Relative to 2016 (Placebo Treatment Year)",
y = "Change in Binge Drinking Prevalence (%)"
) +
theme_minimal()
6
6
6
ggplot(data_control, aes(x = relative_year, y = normalized_prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "orange", size = .3) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Normalized Binge Drinking Trends (Control States Aligned at 2016)",
x = "Years Relative to 2016 (Placebo Treatment Year)",
y = "Change in Binge Drinking Prevalence (%)"
) +
theme_minimal()
data_control <- data %>%
filter(Legalized == 0) %>%
mutate(relative_year = Year - 2012) %>%
group_by(State) %>%
mutate(
baseline = Binge_Drinking_Prevalence[Year == 2012],
normalized_prevalence = Binge_Drinking_Prevalence - baseline
) %>%
ungroup()
ggplot(data_control, aes(x = relative_year, y = normalized_prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "orange", size = .3) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Normalized Binge Drinking Trends (Control States Aligned at 2016)",
x = "Years Relative to 2016 (Placebo Treatment Year)",
y = "Change in Binge Drinking Prevalence (%)"
) +
theme_minimal()
data_control <- data %>%
filter(Legalized == 0) %>%
mutate(relative_year = Year - 2016) %>%
group_by(State) %>%
mutate(
baseline = Binge_Drinking_Prevalence[Year == 2016],
normalized_prevalence = Binge_Drinking_Prevalence - baseline
) %>%
ungroup()
ggplot(data_control, aes(x = relative_year, y = normalized_prevalence, group = State)) +
geom_line(alpha = 0.3, color = "gray") +
stat_summary(fun = mean, geom = "line", color = "orange", size = .3) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Normalized Binge Drinking Trends (Control States Aligned at 2016)",
x = "Years Relative to 2016 (Placebo Treatment Year)",
y = "Change in Binge Drinking Prevalence (%)"
) +
theme_minimal()
# Add group label to each dataset
data_treated <- data %>%
filter(!is.na(Legalization_Year)) %>%
mutate(
relative_year = Year - Legalization_Year,
Group = "Treated"
) %>%
group_by(State) %>%
mutate(
baseline = Binge_Drinking_Prevalence[relative_year == 0],
normalized_prevalence = Binge_Drinking_Prevalence - baseline
) %>%
ungroup()
data_control <- data %>%
filter(Legalized == 0) %>%
mutate(
relative_year = Year - 2016,
Group = "Control"
) %>%
group_by(State) %>%
mutate(
baseline = Binge_Drinking_Prevalence[Year == 2016],
normalized_prevalence = Binge_Drinking_Prevalence - baseline
) %>%
ungroup()
# Combine both datasets
data_combined <- bind_rows(data_treated, data_control)
# Plot
ggplot(data_combined, aes(x = relative_year, y = normalized_prevalence, group = State)) +
geom_line(alpha = 0.15, color = "gray") +
stat_summary(aes(color = Group), fun = mean, geom = "line", size = 1) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Normalized Binge Drinking Trends: Treated vs. Control (Aligned by Year)",
x = "Years Relative to Treatment or 2016",
y = "Change in Binge Drinking Prevalence (%)",
color = "Group"
) +
theme_minimal() +
theme(legend.position = "bottom")
# Plot
ggplot(data_combined, aes(x = relative_year, y = normalized_prevalence, group = State)) +
geom_line(alpha = 0.15, color = "gray") +
stat_summary(aes(color = Group), fun = mean, geom = "line", size = 0/3) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Normalized Binge Drinking Trends: Treated vs. Control (Aligned by Year)",
x = "Years Relative to Treatment or 2016",
y = "Change in Binge Drinking Prevalence (%)",
color = "Group"
) +
theme_minimal() +
theme(legend.position = "bottom")
# Plot
ggplot(data_combined, aes(x = relative_year, y = normalized_prevalence, group = State)) +
geom_line(alpha = 0.15, color = "gray") +
stat_summary(aes(color = Group), fun = mean, geom = "line", size = 0.3) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
labs(
title = "Normalized Binge Drinking Trends: Treated vs. Control (Aligned by Year)",
x = "Years Relative to Treatment or 2016",
y = "Change in Binge Drinking Prevalence (%)",
color = "Group"
) +
theme_minimal() +
theme(legend.position = "bottom")
states <- c("MO", "NE", "KS", "IA", "AR", "OK")
did_subset <- data %>%
filter(State_Abbr %in% states)
states <- c("IL", "NE", "KS", "IA", "AR", "OK")
did_subset <- data %>%
filter(State_Abbr %in% states)
# Illinois legalized in 2020
did_data_il <- did_data_il %>%
mutate(
Treated = ifelse(State_Abbr == "IL", 1, 0),
Post = ifelse(Year >= 2020, 1, 0),
DiD = Treated * Post
)
did_subset <- data %>%
filter(State_Abbr %in% states)
did_data_il <- data %>%
filter(State_Abbr %in% states_il)
states <- c("IL", "NE", "KS", "IA", "AR", "OK")
did_data_il <- data %>%
filter(State_Abbr %in% states_il)
states_il <- c("IL", "NE", "KS", "IA", "AR", "OK")
did_data_il <- data %>%
filter(State_Abbr %in% states_il)
# Illinois legalized in 2020
did_data_il <- did_data_il %>%
mutate(
Treated = ifelse(State_Abbr == "IL", 1, 0),
Post = ifelse(Year >= 2020, 1, 0),
DiD = Treated * Post
)
did_model_il <- lm(
Binge_Drinking_Prevalence ~ DiD + Bachelors_Rate + Median_Age + Urbanization_Rate,
data = did_data_il
)
summary(did_model_il)
library(broom)
tidy(did_model_il) %>%
filter(term == "DiD") %>%
ggplot(aes(x = term, y = estimate)) +
geom_point(size = 3) +
geom_errorbar(aes(ymin = estimate - 1.96 * std.error,
ymax = estimate + 1.96 * std.error), width = 0.2) +
labs(
title = "DiD Estimate: Illinois vs. Border States",
x = "",
y = "Estimated Effect on Binge Drinking (%)"
) +
theme_minimal()
library(dplyr)
library(ggplot2)
library(dplyr)
# Define treatment and control states
states_il <- c("IL", "IA", "IN", "KY", "MO", "WI")
# Create dataset
did_data_il <- data %>%
filter(State_Abbr %in% states_il) %>%
mutate(Group = ifelse(State_Abbr == "IL", "Illinois (Treated)", "Control States"))
states_il <- c("IL", "NE", "KS", "IA", "AR", "OK")
did_data_il <- data %>%
filter(State_Abbr %in% states_il)
# Illinois legalized in 2020
did_data_il <- did_data_il %>%
mutate(
Treated = ifelse(State_Abbr == "IL", 1, 0),
Post = ifelse(Year >= 2020, 1, 0),
DiD = Treated * Post
)
# Plot average binge drinking over time by group
did_data_il %>%
summarise(mean_prevalence = mean(Binge_Drinking_Prevalence, na.rm = TRUE), .groups = "drop") %>%
geom_line(size = 1) +
labs(
subtitle = "Comparing Illinois (Treated) vs. Neighboring Control States",
y = "Binge Drinking Prevalence (%)",
) +
# Plot average binge drinking over time by group
did_data_il %>%
group_by(Year, Group) %>%
summarise(mean_prevalence = mean(Binge_Drinking_Prevalence, na.rm = TRUE), .groups = "drop") %>%
ggplot(aes(x = Year, y = mean_prevalence, color = Group)) +
geom_line(size = 1) +
geom_vline(xintercept = 2020, linetype = "dashed", color = "red") +
labs(
title = "Binge Drinking Prevalence Over Time",
subtitle = "Comparing Illinois (Treated) vs. Neighboring Control States",
x = "Year",
y = "Binge Drinking Prevalence (%)",
color = "Group"
) +
theme_minimal(base_size = 13)
# Plot
ggplot(avg_trend, aes(x = Year, y = mean_prevalence, color = Group)) +
geom_line(size = 1.1) +
geom_vline(xintercept = 2020, linetype = "dashed", color = "red") +
labs(
title = "Binge Drinking Prevalence Over Time",
subtitle = "Illinois (Treated) vs. Border States (Controls)",
x = "Year",
y = "Avg. Binge Drinking Prevalence (%)",
color = "Group"
) +
theme_minimal(base_size = 14)
# Plot
ggplot(avg_trend, aes(x = Year, y = mean_prevalence, color = Group)) +
geom_line(size = 1.1) +
geom_vline(xintercept = 2020, linetype = "dashed", color = "red") +
labs(
title = "Binge Drinking Prevalence Over Time",
subtitle = "Illinois (Treated) vs. Border States (Controls)",
x = "Year",
y = "Avg. Binge Drinking Prevalence (%)",
color = "Group"
) +
theme_minimal(base_size = 14)
# Filter and label data
did_data_il <- data %>%
filter(State_Abbr %in% states_il) %>%
mutate(Group = ifelse(State_Abbr == "IL", "Illinois (Treated)", "Control States"))
# Summarize by year and group
avg_trend <- did_data_il %>%
group_by(Year, Group) %>%
summarise(mean_prevalence = mean(Binge_Drinking_Prevalence, na.rm = TRUE), .groups = "drop")
# Plot
ggplot(avg_trend, aes(x = Year, y = mean_prevalence, color = Group)) +
geom_line(size = 1.1) +
geom_vline(xintercept = 2020, linetype = "dashed", color = "red") +
labs(
title = "Binge Drinking Prevalence Over Time",
subtitle = "Illinois (Treated) vs. Border States (Controls)",
x = "Year",
y = "Avg. Binge Drinking Prevalence (%)",
color = "Group"
) +
theme_minimal(base_size = 14)
This version will generate a clean line graph with:
# Plot
ggplot(avg_trend, aes(x = Year, y = mean_prevalence, color = Group)) +
geom_line(size = 1.1) +
geom_vline(xintercept = 2020, linetype = "dashed", color = "red") +
labs(
title = "Binge Drinking Prevalence Over Time",
subtitle = "Illinois (Treated) vs. Border States (Controls)",
x = "Year",
y = "Avg. Binge Drinking Prevalence (%)",
color = "Group"
) +
theme_minimal(base_size = 14)
